<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DuxV2 | Portfolio</title>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800&display=swap");
    :host,html { line-height:1.5; -webkit-text-size-adjust:100%; -moz-tab-size:4; -o-tab-size:4; tab-size:4; font-family:Poppins,sans-serif; font-feature-settings:normal; font-variation-settings:normal; -webkit-tap-highlight-color:transparent }

    ::-webkit-scrollbar { width: 0px; }
    ::-webkit-scrollbar-track { opacity: 1; }
    ::-webkit-scrollbar-thumb { background: rgba(25, 140, 255, 0.8); border-radius: 15px; }
    ::-webkit-scrollbar-thumb:hover { background: #555; }

    body { margin:0; background:#000; color:#fff; text-align:center; }
    header { display:flex; justify-content:space-between; align-items:center; padding:10px 20px; }
    .logo { font-size:1.5rem; font-weight:bold; }
    h2 { color:#198CFF }
    nav a { color:white; text-decoration:none; margin-left:20px; font-weight:bold; }

    .hero { margin-top:50px; }
    .hero h1 { font-size:3rem; margin:0 0 -30px 0; }
    .hero p { font-size:1.2rem; margin:20px 0; }

    .buttons { margin-top:-20px; }
    .buttons button { font-family:Poppins,sans-serif; padding:12px 24px; margin-top:10px; font-size:1.1rem; border:none; border-radius:8px; cursor:pointer; padding:15px 20px; font-weight:700; }
    .primary { background:#198CFF; color:white; margin-right:4px; }
    .secondary { background:#101218; color:white; margin-left:4px; }

    .stats { display:flex; justify-content:center; margin-top:30px; margin-bottom:-40px; gap:15px; }
    .stat { background:#050505; padding:5px 15px; border-radius:15px; border:1px solid rgba(30,30,30,0.4); width:40%; max-width:350px; }
    .stat-value { margin-bottom:-15px; }

    .games-section { margin-top:100px; }
    .title2 { color:white; font-size:2.5rem; }
    .games-container { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; padding:40px 0; margin-top:-70px; }

    .game { background:#050505; border-radius:12px; border:1px solid rgba(30,30,30,0.4); padding:20px; width:200px; text-align:left; }
    .game img { width:100%; border-radius:10px; }
    .game-title { font-weight:bold; margin:10px 0 10px; }
    .game-meta { font-size:0.9rem; color:#198CFF; }
    .muted { color:#9aa0a6; }
  </style>
</head>
<body>
  <header>
    <div class="logo">DuxV2</div>
    <nav>
      <a href="index.html">Home</a>
      <a href="games.html">Games</a>
    </nav>
  </header>

  <section class="hero">
    <h1>DuxV2</h1>
    <p>Fullstack Luau Programmer</p>
    <div class="buttons">
      <button class="primary" onclick="window.location.href='/games.html'">Explore My Games</button>
      <button class="secondary" onclick="window.location.href='mailto:contact@yourdomain.tld'">Get in Touch</button>
    </div>
    <div class="stats">
      <div class="stat">
        <h2 class="stat-value stat-players">…</h2>
        <p>Total Active Players</p>
      </div>
      <div class="stat">
        <h2 class="stat-value stat-visits">…</h2>
        <p>Total Play Sessions</p>
      </div>
    </div>
  </section>

  <section class="games-section" id="games">
    <h2 class="title2">Top Games</h2>
    <div class="games-container" id="games-container"></div>
  </section>

  <script>
  const UNIVERSE_IDS = [
    8125621001, // My Singing Garden
    7999303512, // Steal a Rapper
    7552829228, // Dead Defense
    8277323040, // Brainrot Fishing
    8626903958, // Untitled Aimbot Game
    5673143329, // Infinite Craft
    8589588983, // Steal Cheese
  ];
  const TOP_N = 3;

  document.addEventListener("DOMContentLoaded", init);

  async function init() {
    if (!UNIVERSE_IDS.length) return;

    const statsEl = {
      players: document.querySelector(".stat-players"),
      visits: document.querySelector(".stat-visits"),
      updated: document.getElementById("last-updated"),
      list: document.getElementById("games-container"),
    };

    const FIVE_MINUTES = 5 * 60 * 1000;
    const STATS_CACHE_KEY = "duxv2_game_data";
    const ICONS_CACHE_KEY = "duxv2_icon_data";
    const TIMESTAMP_KEY = "duxv2_last_update";

    let useCache = false;
    const lastUpdate = localStorage.getItem(TIMESTAMP_KEY);
    const cachedStats = localStorage.getItem(STATS_CACHE_KEY);
    const cachedIcons = localStorage.getItem(ICONS_CACHE_KEY);

    if (lastUpdate && cachedStats && cachedIcons) {
      const elapsed = Date.now() - Number(lastUpdate);
      useCache = elapsed < FIVE_MINUTES;
    }

    let statsJson, iconsJson;
    try {
      if (useCache) {
        statsJson = JSON.parse(cachedStats);
        iconsJson = JSON.parse(cachedIcons);
      } else {
        const [statsRes, iconsRes] = await Promise.all([
          fetch(`https://games.roproxy.com/v1/games?universeIds=${UNIVERSE_IDS.join(",")}`),
          fetch(`https://thumbnails.roproxy.com/v1/games/icons?universeIds=${UNIVERSE_IDS.join(",")}&size=420x420&format=Png`),
        ]);

        statsJson = await statsRes.json();
        iconsJson = await iconsRes.json();

        localStorage.setItem(STATS_CACHE_KEY, JSON.stringify(statsJson));
        localStorage.setItem(ICONS_CACHE_KEY, JSON.stringify(iconsJson));
        localStorage.setItem(TIMESTAMP_KEY, Date.now().toString());
      }
    } catch (err) {
      console.error("Failed to fetch data:", err);
      statsEl.updated.textContent = "Error loading stats";
      return;
    }

    const statsById = Object.create(null);
    for (const g of (statsJson?.data ?? [])) statsById[g.id] = g;

    const iconsById = Object.create(null);
    for (const ic of (iconsJson?.data ?? [])) iconsById[ic.targetId] = ic.imageUrl;

    let totalPlayers = 0;
    let totalVisits = 0;
    const allWithData = [];

    for (const id of UNIVERSE_IDS) {
      const game = statsById[id];
      if (!game) continue;
      const playing = Number(game.playing || 0);
      const visits = Number(game.visits || 0);
      totalPlayers += playing;
      totalVisits += visits;
      allWithData.push({
        id,
        name: game.name || `Universe ${id}`,
        icon: iconsById[id] || "",
        playing,
        visits,
      });
    }

    statsEl.players.textContent = totalPlayers.toLocaleString();
    statsEl.visits.textContent = totalVisits.toLocaleString();
    const dt = new Date();

    allWithData.sort((a, b) => b.playing - a.playing);
    const top = allWithData.slice(0, TOP_N);

    statsEl.list.innerHTML = "";
    for (const g of top) {
      const card = document.createElement("div");
      card.className = "game";
      card.innerHTML = `
        <img src="${g.icon}" alt="Game Thumbnail" loading="lazy" />
        <div class="game-title">${escapeHtml(g.name)}</div>
        <div class="game-meta" style="font-weight:bold;">
          ${g.playing.toLocaleString()} active players<br/>
          <div style="color:white; font-weight:normal;">${g.visits.toLocaleString()} visits</div>
        </div>
      `;
      statsEl.list.appendChild(card);
    }
  }

  function escapeHtml(str) {
    return String(str)
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#039;");
  }
  </script>
</body>
</html>
